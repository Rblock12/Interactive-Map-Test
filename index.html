<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3Cfilter id='shadow' x='-20%' y='-20%' width='140%' height='140%'%3E%3CfeDropShadow dx='0' dy='2' stdDeviation='2' flood-color='%23000' flood-opacity='0.3'/%3E%3C/filter%3E%3C/defs%3E%3Cpath d='M32 6c-9 0-16 7-16 16 0 10.5 13.5 28.5 15.1 30.6a2 2 0 0 0 3.8 0C34.5 50.5 48 32.5 48 22c0-9-7-16-16-16z' fill='%23ea4335' filter='url(%23shadow)'/%3E%3Ccircle cx='32' cy='22' r='7' fill='white' stroke='%23b71c1c' stroke-width='2'/%3E%3C/svg%3E" />
    <title>Map Testing Tool</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="top-bar">
        <h1><i class="fas fa-map-marked-alt"></i> Map Testing Tool</h1>
        <div id="loadMapContainer">
            <input type="file" id="mapFileInput" accept="image/*" style="display:none;" />
            <button id="loadMapButton" type="button">
                <i class="fas fa-upload"></i> Load Map Image
            </button>
            <button id="saveElementsBtn" onclick="saveElements()" style="display: none;">
                <i class="fas fa-save"></i> Save Elements
            </button>
            <button id="loadElementsBtn" onclick="loadElements()" style="display: none;">
                <i class="fas fa-folder-open"></i> Load Elements
            </button>
            <input type="file" id="elementsFileInput" accept=".json" style="display: none;" />
            <input type="file" id="saveElementsFileInput" nwsaveas="map_elements.json" accept=".json"
                style="display: none;" />
            <div id="errorMessage"><i class="fas fa-exclamation-circle"></i> <span></span></div>
        </div>
        <div class="top-buttons">
            <button id="findPointBtn" onclick="toggleTestMode('find')" title="Find the elements">
                <i class="fas fa-search"></i> Find Elements
            </button>
            <button id="identPointBtn" title="Identify the elements">
                <i class="fas fa-map-pin"></i> Identify Elements
            </button>
        </div>
    </div>

    <div class="page-container">

        <div id="mainMenu">
            <div class="menu" role="toolbar" aria-label="Map interaction controls">
                <button id="editToggle" onclick="toggleEditMode()" aria-pressed="false" title="Toggle edit mode">
                    <i class="fas fa-edit"></i> Edit mode
                </button>
                <div class="edit-tools">
                    <button id="addBtn" onclick="toggleAddMenu()" disabled aria-pressed="false" title="Add elements">
                        <i class="fas fa-plus"></i> Add
                    </button>
                    <div id="addSubMenu" style="display: none;">
                        <button id="pointBtn" onclick="setMode('point')" disabled aria-pressed="false" title="Add new point">
                            <i class="fas fa-thumbtack"></i> Point
                        </button>
                        <button id="polygonBtn" onclick="togglePolygonMode()" disabled aria-pressed="false" title="Draw shape">
                            <i class="fas fa-draw-polygon"></i> Shape
                        </button>
                        <button id="lineBtn" onclick="toggleLineMode()" disabled aria-pressed="false" title="Draw line">
                            <i class="fas fa-minus"></i> Line
                        </button>
                    </div>
                    <button id="moveBtn" onclick="setMode('move')" disabled aria-pressed="false" title="Move elements">
                        <i class="fas fa-arrows-alt"></i> Move
                    </button>
                    <button id="editLabelTextBtn" onclick="setMode('editLabelText')" disabled aria-pressed="false"
                        title="Edit element text">
                        <i class="fas fa-font"></i> Edit Text
                    </button>
                    <button id="deleteBtn" onclick="setMode('delete')" disabled aria-pressed="false" title="Delete elements">
                        <i class="fas fa-trash-alt"></i> Delete
                    </button>
                    <button id="tagPanelBtn" onclick="setMode('changeTag')" aria-pressed="false"
                        title="Change existing element tags">
                        <i class="fas fa-tags"></i> Change Tag
                    </button>
                </div>
            </div>
        </div>

        <div class="content-wrapper">
         
            <div id="mapContainer" tabindex="0" aria-label="Map with annotated elements" style="outline:none;">
                <img id="mapImage" alt="Map" />
                <svg id="shapesLayer" aria-hidden="true"></svg>
                <svg id="leaderLines" aria-hidden="true"></svg>
            </div>

            <div id="testInterface">
                <div id="identifyInterface">
                    <input type="text" id="testInput" placeholder="Enter element name..." />
                    <div class="feedback"></div>
                    <div class="progress"></div>
                </div>
                <div id="findInterface">
                    <div id="targetLabel">Find: <span></span></div>
                    <div class="feedback"></div>
                    <div class="progress"></div>
                </div>
                <div class="test-controls">
                    <button id="stopTestBtn" onclick="stopTest()" title="Stop the test">
                        <i class="fas fa-stop"></i> Stop Test
                    </button>
                </div>
            </div>

            <div id="finishDrawingInterface">
                <button id="finishDrawingBtn">
                    <i class="fas fa-check"></i> Finish Drawing
                </button>
            </div>
        </div>
    </div>

    <!-- Tag/Type Sidebar Panel -->
    <div id="tagPanel">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
            <h2 style="font-size:20px; color:#2196F3; margin:0;">Select a Tag</h2>
            <button onclick="toggletagPanel()"
                style="background:none; border:none; font-size:22px; color:#888; cursor:pointer;" title="Close panel"><i
                    class="fas fa-times"></i></button>
        </div>
        <div id="tagTypeListContainer">
            <ul id="tagTypeList" style="list-style:none; padding:0; margin:12px 0 0 0;"></ul>
            <div style="display:flex; gap:8px; margin-top:12px;">
                <input id="newTagInput" type="text" placeholder="Add new tag..."
                    style="flex:1; padding:7px; border-radius:6px; border:1px solid #ccc; font-size:15px;">
                <button onclick="addNewTag()"
                    style="padding:7px 14px; background:#2196F3; color:white; border:none; border-radius:6px; font-size:15px; cursor:pointer;">Add</button>
            </div>
        </div>
        <!-- Edit Tag Modal -->
        <div id="editTagModal"
            style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#fff; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.2); z-index:3000; padding:24px 20px; min-width:300px;">
            <h3 style="margin-top:0; color:#2196F3;">Edit Tag</h3>
            <input id="editTagInput" type="text"
                style="width:100%; padding:8px; border-radius:6px; border:1px solid #ccc; font-size:15px; margin-bottom:16px;">
            <div style="display:flex; justify-content:flex-end; gap:10px;">
                <button onclick="closeEditTagModal()"
                    style="padding:7px 16px; background:#9e9e9e; color:white; border:none; border-radius:6px; font-size:15px; cursor:pointer;">Cancel</button>
                <button onclick="saveEditTag()"
                    style="padding:7px 16px; background:#2196F3; color:white; border:none; border-radius:6px; font-size:15px; cursor:pointer;">Save</button>
            </div>
        </div>
        <!-- Delete Tag Confirmation Modal -->
        <div id="deleteTagModal"
            style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#fff; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.2); z-index:3000; padding:24px 20px; min-width:300px;">
            <h3 style="margin-top:0; color:#f44336;">Delete Tag</h3>
            <p id="deleteTagMsg">Are you sure you want to delete this tag?</p>
            <div style="display:flex; justify-content:flex-end; gap:10px;">
                <button onclick="closeDeleteTagModal()"
                    style="padding:7px 16px; background:#9e9e9e; color:white; border:none; border-radius:6px; font-size:15px; cursor:pointer;">Cancel</button>
                <button onclick="confirmDeleteTag()"
                    style="padding:7px 16px; background:#f44336; color:white; border:none; border-radius:6px; font-size:15px; cursor:pointer;">Delete</button>
            </div>
        </div>
    </div>


    <div id="testTagTypeModal"
        style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.25); z-index:4000; align-items:center; justify-content:center;">
        <div>
            <h3>Select Tag Types for Test</h3>
            <div class="select-btns">
                <button type="button" id="selectAllTestTagsBtn" style="background:#ebe7fb; color:#1522d8;">Select All</button>
                <button type="button" id="deselectAllTestTagsBtn" style="background:#fbe9e7; color:#d84315;">Deselect
                    All</button>
            </div>
            <form id="testTagTypeForm"></form>
            <div class="modal-btns">
                <button type="button" onclick="closeTestTagTypeModal()" style="background:#9e9e9e;">Cancel</button>
                <button type="button" onclick="confirmTestTagTypeModal()">Start Test</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>
